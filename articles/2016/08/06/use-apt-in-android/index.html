<!DOCTYPE html>
<html lang="zh">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">


        <title>Android åˆ©ç”¨ APT æŠ€æœ¯åœ¨ç¼–è¯‘æœŸç”Ÿæˆä»£ç </title>

            <link href="http://brucezz.github.io//feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Brucezz's Corner Full RSS Feed" />

            <link rel="shortcut icon" href="/images/favicon.ico">

        <!-- Bootstrap Core CSS -->
        <link href="http://brucezz.github.io/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="http://brucezz.github.io/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="http://brucezz.github.io/theme/css/code_blocks/colorful.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->






	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Brucezz's Corner">

	<meta property="og:type" content="article">
	<meta property="article:author" content="">
	<meta property="og:url" content="http://brucezz.github.io/articles/2016/08/06/use-apt-in-android/">
	<meta property="og:title" content="Android åˆ©ç”¨ APT æŠ€æœ¯åœ¨ç¼–è¯‘æœŸç”Ÿæˆä»£ç ">
	<meta property="og:description" content="">
	<meta property="og:image" content="http://brucezz.github.io/">
	<meta property="article:published_time" content="2016-08-06 00:00:00+08:00">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://brucezz.github.io/">Brucezz's Corner</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                        <li><a href="/archives.html">å½’æ¡£</a></li>
                        <li><a href="/categories.html">åˆ†ç±»</a></li>
                        <li><a href="/pages/about.html">å…³äºæˆ‘</a></li>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/images/cover/home-bg.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Android åˆ©ç”¨ APT æŠ€æœ¯åœ¨ç¼–è¯‘æœŸç”Ÿæˆä»£ç </h1>
                        <span class="meta">Posted by
                                <a href="http://brucezz.github.io/author/brucezz.html">Brucezz</a>
                             on 2016-08-06
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <p>APT(<code>Annotation Processing Tool</code> çš„ç®€ç§°)ï¼Œå¯ä»¥åœ¨ä»£ç ç¼–è¯‘æœŸè§£ææ³¨è§£ï¼Œå¹¶ä¸”ç”Ÿæˆæ–°çš„ Java æ–‡ä»¶ï¼Œå‡å°‘æ‰‹åŠ¨çš„ä»£ç è¾“å…¥ã€‚ç°åœ¨æœ‰å¾ˆå¤šä¸»æµåº“éƒ½ç”¨ä¸Šäº† APTï¼Œæ¯”å¦‚ Dagger2, ButterKnife, EventBus3 ç­‰ï¼Œæˆ‘ä»¬è¦ç´§è·Ÿæ½®æµï¼Œä¸æ—¶ä¿±è¿›å‘ï¼Â (à¸‡ â€¢Ì€_â€¢Ì)à¸‡</p>
<p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ View æ³¨å…¥é¡¹ç›® <code>ViewFinder</code> æ¥ä»‹ç» APT ç›¸å…³å†…å®¹ï¼Œç®€å•å®ç°äº†ç±»ä¼¼äº <code>ButterKnife</code> ä¸­çš„ä¸¤ç§æ³¨è§£ <code>@BindView</code> å’Œ <code>@OnClick</code> ã€‚</p>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/brucezz/ViewFinder">https://github.com/brucezz/ViewFinder</a></p>
<p>å¤§æ¦‚é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>viewFinder-annotation</code>  - æ³¨è§£ç›¸å…³æ¨¡å—</li>
<li><code>viewFinder-compiler</code>  - æ³¨è§£å¤„ç†å™¨æ¨¡å—</li>
<li><code>viewfinder</code>  - API ç›¸å…³æ¨¡å—</li>
<li><code>sample</code>  - ç¤ºä¾‹ Demo æ¨¡å—</li>
</ul>
<h3>å®ç°ç›®æ ‡</h3>
<p>åœ¨é€šå¸¸çš„ Android é¡¹ç›®ä¸­ï¼Œä¼šå†™å¤§é‡çš„ç•Œé¢ï¼Œé‚£ä¹ˆå°±ä¼šç»å¸¸é‡å¤åœ°å†™ä¸€äº›ä»£ç ï¼Œæ¯”å¦‚ï¼š</p>
<div class="highlight"><pre><span class="n">TextView</span> <span class="n">text</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tv</span><span class="o">);</span>
<span class="n">text</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// on click</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>


<p>å¤©å¤©å†™è¿™ä¹ˆå†—é•¿åˆæ— è„‘çš„ä»£ç ï¼Œè¿˜èƒ½ä¸èƒ½æ„‰å¿«åœ°ç©è€å•¦ã€‚æ‰€ä»¥ï¼Œæˆ‘æ‰“ç®—é€šè¿‡ <code>ViewFinder</code> è¿™ä¸ªé¡¹ç›®æ›¿ä»£è¿™é‡å¤çš„å·¥ä½œï¼Œåªéœ€è¦ç®€å•åœ°æ ‡æ³¨ä¸Šæ³¨è§£å³å¯ã€‚é€šè¿‡æ§ä»¶ id è¿›è¡Œæ³¨è§£ï¼Œå¹¶ä¸” <code>@OnClick</code> å¯ä»¥å¯¹å¤šä¸ªæ§ä»¶æ³¨è§£åŒä¸€ä¸ªæ–¹æ³•ã€‚å°±åƒä¸‹é¢è¿™æ ·å­å’¯ï¼š</p>
<div class="highlight"><pre><span class="nd">@BindView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tv</span><span class="o">)</span> <span class="n">TextView</span> <span class="n">mTextView</span><span class="o">;</span>
<span class="nd">@OnClick</span><span class="o">({</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tv</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btn</span><span class="o">})</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSomethingClick</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// on click</span>
<span class="o">}</span>
</pre></div>


<h3>å®šä¹‰æ³¨è§£</h3>
<blockquote>
<p>åˆ›å»º module  <code>viewFinder-annotation</code> ï¼Œç±»å‹ä¸º Java Libraryï¼Œå®šä¹‰é¡¹ç›®æ‰€éœ€è¦çš„æ³¨è§£ã€‚</p>
</blockquote>
<p>åœ¨ <code>ViewFinder</code> ä¸­éœ€è¦ä¸¤ä¸ªæ³¨è§£ <code>@BindView</code> å’Œ <code>@OnClick</code> ã€‚å®ç°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span class="nd">@Retention</span><span class="o">(</span><span class="n">RetentionPolicy</span><span class="o">.</span><span class="na">CLASS</span><span class="o">)</span>
<span class="nd">@Target</span><span class="o">(</span><span class="n">ElementType</span><span class="o">.</span><span class="na">FIELD</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">BindView</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="nf">value</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>


<div class="highlight"><pre><span class="nd">@Retention</span><span class="o">(</span><span class="n">RetentionPolicy</span><span class="o">.</span><span class="na">CLASS</span><span class="o">)</span>
<span class="nd">@Target</span><span class="o">(</span><span class="n">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">OnClick</span> <span class="o">{</span>
    <span class="kt">int</span><span class="o">[]</span> <span class="nf">value</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>


<p><code>@BindView</code> éœ€è¦å¯¹æˆå‘˜å˜é‡è¿›è¡Œæ³¨è§£ï¼Œå¹¶ä¸”æ¥æ”¶ä¸€ä¸ª int ç±»å‹çš„å‚æ•°ï¼›
<code>@OnClick</code> éœ€è¦å¯¹æ–¹æ³•è¿›è¡Œæ³¨è§£ï¼Œæ¥æ”¶ä¸€ç»„ int ç±»å‹å‚æ•°ï¼Œç›¸å½“äºç»™ä¸€ç»„ View æŒ‡å®šç‚¹å‡»å“åº”äº‹ä»¶ã€‚</p>
<h3>ç¼–å†™ API</h3>
<blockquote>
<p>åˆ›å»º module <code>viewfinder</code>ï¼Œç±»å‹ä¸º Android Libraryã€‚åœ¨è¿™ä¸ª module ä¸­å»å®šä¹‰ APIï¼Œä¹Ÿå°±æ˜¯å»ç¡®å®šè®©åˆ«äººå¦‚ä½•æ¥ä½¿ç”¨æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®ã€‚</p>
</blockquote>
<p>é¦–å…ˆéœ€è¦ä¸€ä¸ª API ä¸»å…¥å£ï¼Œæä¾›é™æ€æ–¹æ³•ç›´æ¥è°ƒç”¨ï¼Œå°±æ¯”å¦‚è¿™æ ·ï¼š</p>
<div class="highlight"><pre><span class="n">ViewFinder</span><span class="o">.</span><span class="na">inject</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</pre></div>


<p>åŒæ—¶ï¼Œéœ€è¦ä¸ºä¸åŒçš„ç›®æ ‡ï¼ˆæ¯”å¦‚ Activityã€Fragment å’Œ View ç­‰ï¼‰æä¾›é‡è½½çš„æ³¨å…¥æ–¹æ³•ï¼Œæœ€ç»ˆéƒ½è°ƒç”¨ <code>inject()</code> æ–¹æ³•ã€‚å…¶ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><code>host</code> è¡¨ç¤ºæ³¨è§£ View å˜é‡æ‰€åœ¨çš„ç±»ï¼Œä¹Ÿå°±æ˜¯æ³¨è§£ç±»</li>
<li><code>source</code> è¡¨ç¤ºæŸ¥æ‰¾ View çš„åœ°æ–¹ï¼ŒActivity &amp; View è‡ªèº«å°±å¯ä»¥æŸ¥æ‰¾ï¼ŒFragment éœ€è¦åœ¨è‡ªå·±çš„ itemView ä¸­æŸ¥æ‰¾</li>
<li><code>provider</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº†ä¸åŒå¯¹è±¡ï¼ˆæ¯”å¦‚ Activityã€View ç­‰ï¼‰å¦‚ä½•å»æŸ¥æ‰¾ç›®æ ‡ Viewï¼Œé¡¹ç›®ä¸­åˆ†åˆ«ä¸º Activityã€View å®ç°äº† <code>Provider</code> æ¥å£ï¼ˆå…·ä½“å®ç°å‚è€ƒ<a href="https://github.com/brucezz/ViewFinder">é¡¹ç›®ä»£ç </a>å§ ğŸ˜„ï¼‰ã€‚</li>
</ul>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ViewFinder</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ActivityProvider</span> <span class="n">PROVIDER_ACTIVITY</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ActivityProvider</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ViewProvider</span> <span class="n">PROVIDER_VIEW</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ViewProvider</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">inject</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">inject</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="n">activity</span><span class="o">,</span> <span class="n">PROVIDER_ACTIVITY</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">inject</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// for view</span>
        <span class="n">inject</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="n">view</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">inject</span><span class="o">(</span><span class="n">Object</span> <span class="n">host</span><span class="o">,</span> <span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// for fragment</span>
        <span class="n">inject</span><span class="o">(</span><span class="n">host</span><span class="o">,</span> <span class="n">view</span><span class="o">,</span> <span class="n">PROVIDER_VIEW</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">inject</span><span class="o">(</span><span class="n">Object</span> <span class="n">host</span><span class="o">,</span> <span class="n">Object</span> <span class="n">source</span><span class="o">,</span> <span class="n">Provider</span> <span class="n">provider</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// how to implement ?</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>é‚£ä¹ˆ <code>inject()</code> æ–¹æ³•ä¸­éƒ½å†™ä¸€äº›ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¥å£ <code>Finder</code>ï¼Œç„¶åä¸ºæ¯ä¸€ä¸ªæ³¨è§£ç±»éƒ½ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„å†…éƒ¨ç±»å¹¶ä¸”å®ç°è¿™ä¸ªæ¥å£ï¼Œç„¶åå®ç°å…·ä½“çš„æ³¨å…¥é€»è¾‘ã€‚åœ¨ <code>inject()</code> æ–¹æ³•ä¸­é¦–å…ˆæ‰¾åˆ°è°ƒç”¨è€…å¯¹åº”çš„ <code>Finder</code> å®ç°ç±»ï¼Œç„¶åè°ƒç”¨å…¶å†…éƒ¨çš„å…·ä½“é€»è¾‘æ¥è¾¾åˆ°æ³¨å…¥çš„ç›®çš„ã€‚</p>
<p>æ¥å£ <code>Finder</code> è®¾è®¡å¦‚ä¸‹ ï¼š</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Finder</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">inject</span><span class="o">(</span><span class="n">T</span> <span class="n">host</span><span class="o">,</span> <span class="n">Object</span> <span class="n">source</span><span class="o">,</span> <span class="n">Provider</span> <span class="n">provider</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>


<p>ä¸¾ä¸ªğŸŒ°ï¼Œä¸º <code>MainActivity</code> ç”Ÿæˆ <code>MainActivity$$Finder</code>ï¼Œå¯¹å…¶æ³¨è§£çš„ View è¿›è¡Œåˆå§‹åŒ–å’Œè®¾ç½®ç‚¹å‡»äº‹ä»¶ï¼Œè¿™å°±è·Ÿæˆ‘ä»¬å¹³å¸¸æ‰€å†™çš„é‡å¤ä»£ç åŸºæœ¬ç›¸åŒã€‚</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity$$Finder</span> <span class="kd">implements</span> <span class="n">Finder</span><span class="o">&lt;</span><span class="n">MainActivity</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">inject</span><span class="o">(</span><span class="kd">final</span> <span class="n">MainActivity</span> <span class="n">host</span><span class="o">,</span> <span class="n">Object</span> <span class="n">source</span><span class="o">,</span> <span class="n">Provider</span> <span class="n">provider</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">host</span><span class="o">.</span><span class="na">mTextView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="o">(</span><span class="n">provider</span><span class="o">.</span><span class="na">findView</span><span class="o">(</span><span class="n">source</span><span class="o">,</span> <span class="mi">2131427414</span><span class="o">));</span>
        <span class="n">host</span><span class="o">.</span><span class="na">mButton</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="o">(</span><span class="n">provider</span><span class="o">.</span><span class="na">findView</span><span class="o">(</span><span class="n">source</span><span class="o">,</span> <span class="mi">2131427413</span><span class="o">));</span>
        <span class="n">host</span><span class="o">.</span><span class="na">mEditText</span> <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span> <span class="o">(</span><span class="n">provider</span><span class="o">.</span><span class="na">findView</span><span class="o">(</span><span class="n">source</span><span class="o">,</span> <span class="mi">2131427412</span><span class="o">));</span>
        <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="n">listener</span><span class="o">;</span>
        <span class="n">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">host</span><span class="o">.</span><span class="na">onButtonClick</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">};</span>
        <span class="n">provider</span><span class="o">.</span><span class="na">findView</span><span class="o">(</span><span class="n">source</span><span class="o">,</span> <span class="mi">2131427413</span><span class="o">).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
        <span class="n">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">host</span><span class="o">.</span><span class="na">onTextClick</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">};</span>
        <span class="n">provider</span><span class="o">.</span><span class="na">findView</span><span class="o">(</span><span class="n">source</span><span class="o">,</span> <span class="mi">2131427414</span><span class="o">).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>å¥½äº†ï¼Œæ‰€æœ‰æ³¨è§£ç±»éƒ½æœ‰äº†ä¸€ä¸ªåä¸º <code>xx$$Finder</code> çš„å†…éƒ¨ç±»ã€‚æˆ‘ä»¬é¦–å…ˆé€šè¿‡æ³¨è§£ç±»çš„ç±»åï¼Œå¾—åˆ°å…¶å¯¹åº”å†…éƒ¨ç±»çš„ Class å¯¹è±¡ï¼Œç„¶åå®ä¾‹åŒ–æ‹¿åˆ°å…·ä½“å¯¹è±¡ï¼Œè°ƒç”¨æ³¨å…¥æ–¹æ³•ã€‚</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ViewFinder</span> <span class="o">{</span>

    <span class="c1">// same as above</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Finder</span><span class="o">&gt;</span> <span class="n">FINDER_MAP</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">inject</span><span class="o">(</span><span class="n">Object</span> <span class="n">host</span><span class="o">,</span> <span class="n">Object</span> <span class="n">source</span><span class="o">,</span> <span class="n">Provider</span> <span class="n">provider</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">className</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Finder</span> <span class="n">finder</span> <span class="o">=</span> <span class="n">FINDER_MAP</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">className</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">finder</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">finderClass</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">className</span> <span class="o">+</span> <span class="s">&quot;$$Finder&quot;</span><span class="o">);</span>
                <span class="n">finder</span> <span class="o">=</span> <span class="o">(</span><span class="n">Finder</span><span class="o">)</span> <span class="n">finderClass</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
                <span class="n">FINDER_MAP</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">className</span><span class="o">,</span> <span class="n">finder</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">finder</span><span class="o">.</span><span class="na">inject</span><span class="o">(</span><span class="n">host</span><span class="o">,</span> <span class="n">source</span><span class="o">,</span> <span class="n">provider</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&quot;Unable to inject for &quot;</span> <span class="o">+</span> <span class="n">className</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>å¦å¤–ä»£ç ä¸­ä½¿ç”¨åˆ°äº†ä¸€ç‚¹åå°„ï¼Œä¸ºäº†æé«˜æ•ˆç‡ï¼Œé¿å…æ¯æ¬¡æ³¨å…¥çš„æ—¶å€™éƒ½å»æ‰¾ <code>Finder</code> å¯¹è±¡ï¼Œç”¨ä¸€ä¸ª Map å°†ç¬¬ä¸€æ¬¡æ‰¾åˆ°çš„å¯¹è±¡ç¼“å­˜èµ·æ¥ï¼Œåé¢ç”¨çš„æ—¶å€™ç›´æ¥ä» Map é‡Œé¢å–ã€‚</p>
<p>åˆ°æ­¤ï¼ŒAPI æ¨¡å—çš„è®¾è®¡åŸºæœ¬æå®šäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å»é€šè¿‡æ³¨è§£å¤„ç†å™¨ä¸ºæ¯ä¸€ä¸ªæ³¨è§£ç±»ç”Ÿæˆ <code>Finder</code> å†…éƒ¨ç±»ã€‚</p>
<h3>åˆ›å»ºæ³¨è§£å¤„ç†å™¨</h3>
<blockquote>
<p>åˆ›å»º module <code>viewFinder-compiler</code>ï¼Œç±»å‹ä¸º Java Libraryï¼Œå®ç°ä¸€ä¸ªæ³¨è§£å¤„ç†å™¨ã€‚</p>
</blockquote>
<p>è¿™ä¸ªæ¨¡å—éœ€è¦æ·»åŠ ä¸€äº›ä¾èµ–ï¼š</p>
<div class="highlight"><pre><span class="n">compile</span> <span class="nf">project</span><span class="o">(</span><span class="s1">&#39;:viewfinder-annotation&#39;</span><span class="o">)</span>
<span class="n">compile</span> <span class="s1">&#39;com.squareup:javapoet:1.7.0&#39;</span>
<span class="n">compile</span> <span class="s1">&#39;com.google.auto.service:auto-service:1.0-rc2&#39;</span>
</pre></div>


<ul>
<li>å› ä¸ºè¦ç”¨åˆ°å‰é¢å®šä¹‰çš„æ³¨è§£ï¼Œå½“ç„¶è¦ä¾èµ– <code>viewFinder-annotation</code>ã€‚</li>
<li><code>javapoet</code> æ˜¯<strong>æ–¹å—å…¬å¸</strong>å‡ºçš„åˆä¸€ä¸ªå¥½ç”¨åˆ°çˆ†ç‚¸çš„è£¤å­ï¼Œæä¾›äº†å„ç§ API è®©ä½ ç”¨å„ç§å§¿åŠ¿å»ç”Ÿæˆ Java ä»£ç æ–‡ä»¶ï¼Œé¿å…äº†å¾’æ‰‹æ‹¼æ¥å­—ç¬¦ä¸²çš„å°´å°¬ã€‚</li>
<li><code>auto-service</code> æ˜¯ Google å®¶çš„è£¤å­ï¼Œä¸»è¦ç”¨äºæ³¨è§£ <code>Processor</code>ï¼Œå¯¹å…¶ç”Ÿæˆ <code>META-INF</code> é…ç½®ä¿¡æ¯ã€‚</li>
</ul>
<p>ä¸‹é¢å°±æ¥åˆ›å»ºæˆ‘ä»¬çš„å¤„ç†å™¨ <code>ViewFinderProcessor</code>ã€‚</p>
<div class="highlight"><pre><span class="nd">@AutoService</span><span class="o">(</span><span class="n">Processor</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ViewFinderProcesser</span> <span class="kd">extends</span> <span class="n">AbstractProcessor</span> <span class="o">{</span>

    <span class="cm">/**</span>
<span class="cm">     * ä½¿ç”¨ Google çš„ auto-service åº“å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ META-INF/services/javax.annotation.processing.Processor æ–‡ä»¶</span>
<span class="cm">     */</span>

    <span class="kd">private</span> <span class="n">Filer</span> <span class="n">mFiler</span><span class="o">;</span> <span class="c1">//æ–‡ä»¶ç›¸å…³çš„è¾…åŠ©ç±»</span>
    <span class="kd">private</span> <span class="n">Elements</span> <span class="n">mElementUtils</span><span class="o">;</span> <span class="c1">//å…ƒç´ ç›¸å…³çš„è¾…åŠ©ç±»</span>
    <span class="kd">private</span> <span class="n">Messager</span> <span class="n">mMessager</span><span class="o">;</span> <span class="c1">//æ—¥å¿—ç›¸å…³çš„è¾…åŠ©ç±»</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">ProcessingEnvironment</span> <span class="n">processingEnv</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">processingEnv</span><span class="o">);</span>
        <span class="n">mFiler</span> <span class="o">=</span> <span class="n">processingEnv</span><span class="o">.</span><span class="na">getFiler</span><span class="o">();</span>
        <span class="n">mElementUtils</span> <span class="o">=</span> <span class="n">processingEnv</span><span class="o">.</span><span class="na">getElementUtils</span><span class="o">();</span>
        <span class="n">mMessager</span> <span class="o">=</span> <span class="n">processingEnv</span><span class="o">.</span><span class="na">getMessager</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * @return æŒ‡å®šå“ªäº›æ³¨è§£åº”è¯¥è¢«æ³¨è§£å¤„ç†å™¨æ³¨å†Œ</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getSupportedAnnotationTypes</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">types</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashSet</span><span class="o">&lt;&gt;();</span>
        <span class="n">types</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">BindView</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getCanonicalName</span><span class="o">());</span>
        <span class="n">types</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">OnClick</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getCanonicalName</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">types</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * @return æŒ‡å®šä½¿ç”¨çš„ Java ç‰ˆæœ¬ã€‚é€šå¸¸è¿”å› SourceVersion.latestSupported()ã€‚</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">SourceVersion</span> <span class="nf">getSupportedSourceVersion</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">SourceVersion</span><span class="o">.</span><span class="na">latestSupported</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">process</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">TypeElement</span><span class="o">&gt;</span> <span class="n">annotations</span><span class="o">,</span> <span class="n">RoundEnvironment</span> <span class="n">roundEnv</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// to process annotations </span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>ç”¨ <code>@AutoService</code> æ¥æ³¨è§£è¿™ä¸ªå¤„ç†å™¨ï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆé…ç½®ä¿¡æ¯ã€‚</p>
<p>åœ¨ <code>init()</code> å¯ä»¥åˆå§‹åŒ–æ‹¿åˆ°ä¸€äº›å®ç”¨çš„å·¥å…·ç±»ã€‚</p>
<p>åœ¨ <code>getSupportedAnnotationTypes()</code> æ–¹æ³•ä¸­è¿”å›æ‰€è¦å¤„ç†çš„æ³¨è§£çš„é›†åˆã€‚</p>
<p>åœ¨ <code>getSupportedSourceVersion()</code> æ–¹æ³•ä¸­è¿”å› Java ç‰ˆæœ¬ã€‚</p>
<p>è¿™å‡ ä¸ªæ–¹æ³•å†™æ³•åŸºæœ¬ä¸Šéƒ½æ˜¯å›ºå®šçš„ï¼Œé‡å¤´æˆåœ¨ <code>process()</code> æ–¹æ³•ã€‚</p>
<blockquote>
<p>è¿™é‡Œæ’æ’­ä¸€ä¸‹ <code>Element</code> å…ƒç´ ç›¸å…³æ¦‚å¿µï¼Œåé¢ä¼šç”¨åˆ°ä¸å°‘ã€‚</p>
</blockquote>
<p><code>Element</code> å…ƒç´ ï¼Œæºä»£ç ä¸­çš„æ¯ä¸€éƒ¨åˆ†éƒ½æ˜¯ä¸€ä¸ªç‰¹å®šçš„å…ƒç´ ç±»å‹ï¼Œåˆ†åˆ«ä»£è¡¨äº†åŒ…ã€ç±»ã€æ–¹æ³•ç­‰ç­‰ï¼Œå…·ä½“çœ‹ Demoã€‚</p>
<div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span> <span class="c1">// TypeElement</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">a</span><span class="o">;</span> <span class="c1">// VariableElement</span>
    <span class="kd">private</span> <span class="n">Foo</span> <span class="n">other</span><span class="o">;</span> <span class="c1">// VariableElement</span>

    <span class="kd">public</span> <span class="nf">Foo</span><span class="o">()</span> <span class="o">{}</span> <span class="c1">// ExecuteableElement</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setA</span><span class="o">(</span> <span class="c1">// ExecuteableElement</span>
            <span class="kt">int</span> <span class="n">newA</span> <span class="c1">// TypeElement</span>
    <span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>è¿™äº› <code>Element</code> å…ƒç´ ï¼Œç›¸å½“äº XML ä¸­çš„ DOM æ ‘ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªå…ƒç´ å»è®¿é—®å®ƒçš„çˆ¶å…ƒç´ æˆ–è€…å­å…ƒç´ ã€‚</p>
<div class="highlight"><pre><span class="n">element</span><span class="o">.</span><span class="na">getEnclosingElement</span><span class="o">();</span><span class="c1">// è·å–çˆ¶å…ƒç´ </span>
<span class="n">element</span><span class="o">.</span><span class="na">getEnclosedElements</span><span class="o">();</span><span class="c1">// è·å–å­å…ƒç´ </span>
</pre></div>


<p>æ³¨è§£å¤„ç†å™¨çš„æ•´ä¸ªå¤„ç†è¿‡ç¨‹è·Ÿæ™®é€šçš„ Java ç¨‹åºæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ€æƒ³å’Œè®¾è®¡æ¨¡å¼ï¼Œå°†ç›¸å…³é€»è¾‘å°è£…åˆ° model ä¸­ï¼Œä½¿å¾—æµç¨‹æ›´æ¸…æ™°ç®€æ´ã€‚åˆ†åˆ«å°†æ³¨è§£çš„æˆå‘˜å˜é‡ã€ç‚¹å‡»æ–¹æ³•å’Œæ•´ä¸ªæ³¨è§£ç±»å°è£…æˆä¸åŒçš„ modelã€‚</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BindViewField</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">VariableElement</span> <span class="n">mFieldElement</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mResId</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">BindViewField</span><span class="o">(</span><span class="n">Element</span> <span class="n">element</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IllegalArgumentException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">getKind</span><span class="o">()</span> <span class="o">!=</span> <span class="n">ElementKind</span><span class="o">.</span><span class="na">FIELD</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
                <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Only fields can be annotated with @%s&quot;</span><span class="o">,</span> <span class="n">BindView</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">()));</span>
        <span class="o">}</span>

        <span class="n">mFieldElement</span> <span class="o">=</span> <span class="o">(</span><span class="n">VariableElement</span><span class="o">)</span> <span class="n">element</span><span class="o">;</span>
        <span class="n">BindView</span> <span class="n">bindView</span> <span class="o">=</span> <span class="n">mFieldElement</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="n">BindView</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">mResId</span> <span class="o">=</span> <span class="n">bindView</span><span class="o">.</span><span class="na">value</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">// some getter methods</span>
<span class="o">}</span>
</pre></div>


<p>ä¸»è¦å°±æ˜¯åœ¨åˆå§‹åŒ–æ—¶æ ¡éªŒäº†ä¸€ä¸‹å…ƒç´ ç±»å‹ï¼Œç„¶åè·å–æ³¨è§£çš„å€¼ï¼Œåœ¨æä¾›å‡ ä¸ª get æ–¹æ³•ã€‚<code>OnClickMethod</code> å°è£…ç±»ä¼¼ã€‚</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AnnotatedClass</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">TypeElement</span> <span class="n">mClassElement</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">BindViewField</span><span class="o">&gt;</span> <span class="n">mFields</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OnClickMethod</span><span class="o">&gt;</span> <span class="n">mMethods</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">Elements</span> <span class="n">mElementUtils</span><span class="o">;</span>

    <span class="c1">// omit some easy methods </span>

    <span class="kd">public</span> <span class="n">JavaFile</span> <span class="nf">generateFinder</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// method inject(final T host, Object source, Provider provider)</span>
        <span class="n">MethodSpec</span><span class="o">.</span><span class="na">Builder</span> <span class="n">injectMethodBuilder</span> <span class="o">=</span> <span class="n">MethodSpec</span><span class="o">.</span><span class="na">methodBuilder</span><span class="o">(</span><span class="s">&quot;inject&quot;</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addModifiers</span><span class="o">(</span><span class="n">Modifier</span><span class="o">.</span><span class="na">PUBLIC</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addAnnotation</span><span class="o">(</span><span class="n">Override</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addParameter</span><span class="o">(</span><span class="n">TypeName</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">mClassElement</span><span class="o">.</span><span class="na">asType</span><span class="o">()),</span> <span class="s">&quot;host&quot;</span><span class="o">,</span> <span class="n">Modifier</span><span class="o">.</span><span class="na">FINAL</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addParameter</span><span class="o">(</span><span class="n">TypeName</span><span class="o">.</span><span class="na">OBJECT</span><span class="o">,</span> <span class="s">&quot;source&quot;</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addParameter</span><span class="o">(</span><span class="n">TypeUtil</span><span class="o">.</span><span class="na">PROVIDER</span><span class="o">,</span> <span class="s">&quot;provider&quot;</span><span class="o">);</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">BindViewField</span> <span class="n">field</span> <span class="o">:</span> <span class="n">mFields</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// find views</span>
            <span class="n">injectMethodBuilder</span><span class="o">.</span><span class="na">addStatement</span><span class="o">(</span><span class="s">&quot;host.$N = ($T)(provider.findView(source, $L))&quot;</span><span class="o">,</span> <span class="n">field</span><span class="o">.</span><span class="na">getFieldName</span><span class="o">(),</span>
                <span class="n">ClassName</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">field</span><span class="o">.</span><span class="na">getFieldType</span><span class="o">()),</span> <span class="n">field</span><span class="o">.</span><span class="na">getResId</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">mMethods</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">injectMethodBuilder</span><span class="o">.</span><span class="na">addStatement</span><span class="o">(</span><span class="s">&quot;$T listener&quot;</span><span class="o">,</span> <span class="n">TypeUtil</span><span class="o">.</span><span class="na">ANDROID_ON_CLICK_LISTENER</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OnClickMethod</span> <span class="n">method</span> <span class="o">:</span> <span class="n">mMethods</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// declare OnClickListener anonymous class</span>
            <span class="n">TypeSpec</span> <span class="n">listener</span> <span class="o">=</span> <span class="n">TypeSpec</span><span class="o">.</span><span class="na">anonymousClassBuilder</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addSuperinterface</span><span class="o">(</span><span class="n">TypeUtil</span><span class="o">.</span><span class="na">ANDROID_ON_CLICK_LISTENER</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addMethod</span><span class="o">(</span><span class="n">MethodSpec</span><span class="o">.</span><span class="na">methodBuilder</span><span class="o">(</span><span class="s">&quot;onClick&quot;</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">addAnnotation</span><span class="o">(</span><span class="n">Override</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">addModifiers</span><span class="o">(</span><span class="n">Modifier</span><span class="o">.</span><span class="na">PUBLIC</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">returns</span><span class="o">(</span><span class="n">TypeName</span><span class="o">.</span><span class="na">VOID</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">addParameter</span><span class="o">(</span><span class="n">TypeUtil</span><span class="o">.</span><span class="na">ANDROID_VIEW</span><span class="o">,</span> <span class="s">&quot;view&quot;</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">addStatement</span><span class="o">(</span><span class="s">&quot;host.$N()&quot;</span><span class="o">,</span> <span class="n">method</span><span class="o">.</span><span class="na">getMethodName</span><span class="o">())</span>
                    <span class="o">.</span><span class="na">build</span><span class="o">())</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            <span class="n">injectMethodBuilder</span><span class="o">.</span><span class="na">addStatement</span><span class="o">(</span><span class="s">&quot;listener = $L &quot;</span><span class="o">,</span> <span class="n">listener</span><span class="o">);</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">id</span> <span class="o">:</span> <span class="n">method</span><span class="o">.</span><span class="na">ids</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// set listeners</span>
                <span class="n">injectMethodBuilder</span><span class="o">.</span><span class="na">addStatement</span><span class="o">(</span><span class="s">&quot;provider.findView(source, $L).setOnClickListener(listener)&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">// generate whole class </span>
        <span class="n">TypeSpec</span> <span class="n">finderClass</span> <span class="o">=</span> <span class="n">TypeSpec</span><span class="o">.</span><span class="na">classBuilder</span><span class="o">(</span><span class="n">mClassElement</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;$$Finder&quot;</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addModifiers</span><span class="o">(</span><span class="n">Modifier</span><span class="o">.</span><span class="na">PUBLIC</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addSuperinterface</span><span class="o">(</span><span class="n">ParameterizedTypeName</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">TypeUtil</span><span class="o">.</span><span class="na">FINDER</span><span class="o">,</span> <span class="n">TypeName</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">mClassElement</span><span class="o">.</span><span class="na">asType</span><span class="o">())))</span>
            <span class="o">.</span><span class="na">addMethod</span><span class="o">(</span><span class="n">injectMethodBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">())</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">packageName</span> <span class="o">=</span> <span class="n">mElementUtils</span><span class="o">.</span><span class="na">getPackageOf</span><span class="o">(</span><span class="n">mClassElement</span><span class="o">).</span><span class="na">getQualifiedName</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="c1">// generate file</span>
        <span class="k">return</span> <span class="n">JavaFile</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="n">packageName</span><span class="o">,</span> <span class="n">finderClass</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p><code>AnnotatedClass</code> è¡¨ç¤ºä¸€ä¸ªæ³¨è§£ç±»ï¼Œé‡Œé¢æ”¾äº†ä¸¤ä¸ªåˆ—è¡¨ï¼Œåˆ†åˆ«è£…ç€æ³¨è§£çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•ã€‚åœ¨ <code>generateFinder()</code> æ–¹æ³•ä¸­ï¼ŒæŒ‰ç…§ä¸Šä¸€èŠ‚è®¾è®¡çš„æ¨¡æ¿ï¼Œåˆ©ç”¨ <code>JavaPoet</code> çš„ API ç”Ÿæˆä»£ç ã€‚è¿™éƒ¨åˆ†æ²¡å•¥ç‰¹åˆ«çš„å§¿åŠ¿ï¼Œç…§ç€ <a href="https://github.com/square/javapoet">JavaPoet æ–‡æ¡£</a> æ¥å°±å¥½äº†ï¼Œæ–‡æ¡£å†™å¾—å¾ˆç»†è‡´ã€‚</p>
<blockquote>
<p>æœ‰å¾ˆå¤šåœ°æ–¹éœ€è¦ç”¨åˆ°å¯¹è±¡çš„ç±»å‹ï¼Œæ™®é€šç±»å‹å¯ä»¥ç”¨</p>
<p><code>ClassName get(String packageName, String simpleName, String... simpleNames)</code></p>
<p>ä¼ å…¥åŒ…åã€ç±»åã€å†…éƒ¨ç±»åï¼Œå°±å¯ä»¥æ‹¿åˆ°æƒ³è¦çš„ç±»å‹äº†ï¼ˆå¯ä»¥å‚è€ƒ é¡¹ç›®ä¸­<code>TypeUtil</code> ç±»ï¼‰ã€‚</p>
<p>ç”¨åˆ°æ³›å‹çš„è¯ï¼Œå¯ä»¥ç”¨</p>
<p><code>ParameterizedTypeName get(ClassName rawType, TypeName... typeArguments)</code></p>
<p>ä¼ å…¥å…·ä½“ç±»å’Œæ³›å‹ç±»å‹å°±å¥½äº†ã€‚</p>
</blockquote>
<p>è¿™äº› model éƒ½ç¡®å®šå¥½äº†ä¹‹åï¼Œ<code>process()</code> æ–¹æ³•å°±å¾ˆæ¸…çˆ½å•¦ã€‚ä½¿ç”¨ <code>RoundEnvironment</code> å‚æ•°æ¥æŸ¥è¯¢è¢«ç‰¹å®šæ³¨è§£æ ‡æ³¨çš„å…ƒç´ ï¼Œç„¶åè§£ææˆå…·ä½“çš„ modelï¼Œæœ€åç”Ÿæˆä»£ç è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ã€‚</p>
<div class="highlight"><pre><span class="nd">@AutoService</span><span class="o">(</span><span class="n">Processor</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ViewFinderProcesser</span> <span class="kd">extends</span> <span class="n">AbstractProcessor</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AnnotatedClass</span><span class="o">&gt;</span> <span class="n">mAnnotatedClassMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">process</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">TypeElement</span><span class="o">&gt;</span> <span class="n">annotations</span><span class="o">,</span> <span class="n">RoundEnvironment</span> <span class="n">roundEnv</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// process() will be called several times</span>
        <span class="n">mAnnotatedClassMap</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">processBindView</span><span class="o">(</span><span class="n">roundEnv</span><span class="o">);</span>
            <span class="n">processOnClick</span><span class="o">(</span><span class="n">roundEnv</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalArgumentException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span> <span class="c1">// stop process</span>
        <span class="o">}</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">AnnotatedClass</span> <span class="n">annotatedClass</span> <span class="o">:</span> <span class="n">mAnnotatedClassMap</span><span class="o">.</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">info</span><span class="o">(</span><span class="s">&quot;Generating file for %s&quot;</span><span class="o">,</span> <span class="n">annotatedClass</span><span class="o">.</span><span class="na">getFullClassName</span><span class="o">());</span>
                <span class="n">annotatedClass</span><span class="o">.</span><span class="na">generateFinder</span><span class="o">().</span><span class="na">writeTo</span><span class="o">(</span><span class="n">mFiler</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">error</span><span class="o">(</span><span class="s">&quot;Generate file failed, reason: %s&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">processBindView</span><span class="o">(</span><span class="n">RoundEnvironment</span> <span class="n">roundEnv</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IllegalArgumentException</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Element</span> <span class="n">element</span> <span class="o">:</span> <span class="n">roundEnv</span><span class="o">.</span><span class="na">getElementsAnnotatedWith</span><span class="o">(</span><span class="n">BindView</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">AnnotatedClass</span> <span class="n">annotatedClass</span> <span class="o">=</span> <span class="n">getAnnotatedClass</span><span class="o">(</span><span class="n">element</span><span class="o">);</span>
            <span class="n">BindViewField</span> <span class="n">field</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BindViewField</span><span class="o">(</span><span class="n">element</span><span class="o">);</span>
            <span class="n">annotatedClass</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="n">field</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">processOnClick</span><span class="o">(</span><span class="n">RoundEnvironment</span> <span class="n">roundEnv</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// same as processBindView()</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">AnnotatedClass</span> <span class="nf">getAnnotatedClass</span><span class="o">(</span><span class="n">Element</span> <span class="n">element</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">TypeElement</span> <span class="n">classElement</span> <span class="o">=</span> <span class="o">(</span><span class="n">TypeElement</span><span class="o">)</span> <span class="n">element</span><span class="o">.</span><span class="na">getEnclosingElement</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">fullClassName</span> <span class="o">=</span> <span class="n">classElement</span><span class="o">.</span><span class="na">getQualifiedName</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="n">AnnotatedClass</span> <span class="n">annotatedClass</span> <span class="o">=</span> <span class="n">mAnnotatedClassMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">fullClassName</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">annotatedClass</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">annotatedClass</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotatedClass</span><span class="o">(</span><span class="n">classElement</span><span class="o">,</span> <span class="n">mElementUtils</span><span class="o">);</span>
            <span class="n">mAnnotatedClassMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">fullClassName</span><span class="o">,</span> <span class="n">annotatedClass</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">annotatedClass</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>é¦–å…ˆè§£ææ³¨è§£å…ƒç´ ï¼Œå¹¶æ”¾åˆ°å¯¹åº”çš„æ³¨è§£ç±»å¯¹è±¡ä¸­ï¼Œæœ€åè°ƒç”¨æ–¹æ³•ç”Ÿæˆæ–‡ä»¶ã€‚model çš„ä»£ç ä¸­è¿˜ä¼šåŠ å…¥ä¸€äº›æ ¡éªŒä»£ç ï¼Œæ¥åˆ¤æ–­æ³¨è§£å…ƒç´ æ˜¯å¦åˆç†ï¼Œæ•°æ®æ˜¯å¦æ­£å¸¸ï¼Œç„¶åæŠ›å‡ºå¼‚å¸¸ï¼Œå¤„ç†å™¨æ¥æ”¶åˆ°ä¹‹åå¯ä»¥æ‰“å°å‡ºé”™è¯¯æç¤ºï¼Œç„¶åç›´æ¥è¿”å› <code>true</code> æ¥ç»“æŸå¤„ç†ã€‚</p>
<p>è‡³æ­¤ï¼Œæ³¨è§£å¤„ç†å™¨ä¹ŸåŸºæœ¬å®Œæˆäº†ï¼Œå…·ä½“ç»†èŠ‚å‚è€ƒé¡¹ç›®ä»£ç ã€‚</p>
<h3>å®é™…é¡¹ç›®ä½¿ç”¨</h3>
<blockquote>
<p>åˆ›å»º module <code>sample</code>ï¼Œæ™®é€šçš„ Android moduleï¼Œæ¥æ¼”ç¤º <code>ViewFinder</code> çš„ä½¿ç”¨ã€‚</p>
</blockquote>
<p>åœ¨æ•´ä¸ªé¡¹ç›®ä¸‹çš„ <code>build.gradle</code> ä¸­æ·»åŠ </p>
<p><code>classpath 'com.neenbedankt.gradle.plugins:android-apt:1.8'</code></p>
<p>ç„¶ååœ¨ <code>sample</code> module ä¸‹çš„ <code>build.gradle</code> ä¸­æ·»åŠ </p>
<p><code>apply plugin: 'com.neenbedankt.android-apt'</code></p>
<p>åŒæ—¶æ·»åŠ ä¾èµ–ï¼š</p>
<div class="highlight"><pre><span class="n">compile</span> <span class="nf">project</span><span class="o">(</span><span class="s1">&#39;:viewfinder-annotation&#39;</span><span class="o">)</span>
<span class="n">compile</span> <span class="nf">project</span><span class="o">(</span><span class="s1">&#39;:viewfinder&#39;</span><span class="o">)</span>
<span class="n">apt</span> <span class="nf">project</span><span class="o">(</span><span class="s1">&#39;:viewfinder-compiler&#39;</span><span class="o">)</span>
</pre></div>


<p>ç„¶åéšä¾¿åˆ›å»ºä¸ªå¸ƒå±€ï¼Œéšä¾¿æ·»åŠ å‡ ä¸ªæ§ä»¶ï¼Œå°±èƒ½ä½“éªŒæ³¨è§£å•¦ã€‚</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>
    <span class="nd">@BindView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tv</span><span class="o">)</span> <span class="n">TextView</span> <span class="n">mTextView</span><span class="o">;</span>
    <span class="nd">@BindView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btn</span><span class="o">)</span> <span class="n">Button</span> <span class="n">mButton</span><span class="o">;</span>
    <span class="nd">@BindView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">et</span><span class="o">)</span> <span class="n">EditText</span> <span class="n">mEditText</span><span class="o">;</span>

    <span class="nd">@OnClick</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btn</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onButtonClick</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;onButtonClick&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@OnClick</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tv</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTextClick</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;onTextClick&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
        <span class="n">ViewFinder</span><span class="o">.</span><span class="na">inject</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>è¿™ä¸ªæ—¶å€™ build ä¸€ä¸‹é¡¹ç›®ï¼Œå°±èƒ½çœ‹åˆ°ç”Ÿæˆçš„ <code>MainActivity$$Finder</code> ç±»äº†ï¼Œå†è¿è¡Œé¡¹ç›®å°±è·‘èµ·æ¥äº†ã€‚æ¯æ¬¡æ”¹å˜æ³¨è§£ä¹‹åï¼Œbuild ä¸€ä¸‹é¡¹ç›®å°±å¥½å•¦ã€‚</p>
<p>all done ~</p>
<p>è¿™ä¸ªé¡¹ç›®ä¹Ÿå°±æ˜¯ä¸ªç©å…·çº§çš„ APT é¡¹ç›®ï¼Œå€Ÿæ­¤æ¥å­¦ä¹ å¦‚ä½•ç¼–å†™ APT é¡¹ç›®ã€‚æ„Ÿè§‰ APT é¡¹ç›®æ›´å¤šåœ°æ˜¯è€ƒè™‘å¦‚ä½•å»è®¾è®¡æ¶æ„ï¼Œç±»ä¹‹é—´å¦‚ä½•è°ƒç”¨ï¼Œéœ€è¦ç”Ÿæˆä»€ä¹ˆæ ·çš„ä»£ç ï¼Œæä¾›æ€æ ·çš„ API å»è°ƒç”¨ã€‚æœ€åæ‰æ˜¯åˆ©ç”¨æ³¨è§£å¤„ç†å™¨å»è§£ææ³¨è§£ï¼Œç„¶åç”¨ JavaPoet å»ç”Ÿæˆå…·ä½“çš„ä»£ç ã€‚</p>
<p>æ€è·¯æ¯”å®ç°æ›´é‡è¦ï¼Œè®¾è®¡æ¯”ä»£ç æ›´å·§å¦™ã€‚</p>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="http://qiushao.net/2015/07/07/Annotation-Processing-Tool%E8%AF%A6%E8%A7%A3/">Annotation-Processing-Toolè¯¦è§£</a> ï¼ˆå¤§åŠ›æ¨èï¼‰</li>
<li><a href="http://blog.csdn.net/lmj623565791/article/details/51931859">Android å¦‚ä½•ç¼–å†™åŸºäºç¼–è¯‘æ—¶æ³¨è§£çš„é¡¹ç›®</a></li>
<li><a href="https://github.com/square/javapoet">JavaPoet æ–‡æ¡£</a> </li>
<li><a href="https://github.com/JakeWharton/butterknife">ButterKnife</a> ï¼ˆä»£ç ç»“æ„è®¾è®¡å¾ˆæ£’ï¼‰</li>
</ul>
    </article>


<hr>
<div class="sharing">
</div>
    <hr>

    <!-- å¤šè¯´è¯„è®ºæ¡† start -->
    <div class="ds-thread" data-thread-key="use-apt-in-android" data-title="Android åˆ©ç”¨ APT æŠ€æœ¯åœ¨ç¼–è¯‘æœŸç”Ÿæˆä»£ç " data-url="http://brucezz.github.io/articles/2016/08/06/use-apt-in-android/"></div>
<!-- å¤šè¯´è¯„è®ºæ¡† end -->
<!-- å¤šè¯´å…¬å…±JSä»£ç  start (ä¸€ä¸ªç½‘é¡µåªéœ€æ’å…¥ä¸€æ¬¡) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"brucezz"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
<!-- å¤šè¯´å…¬å…±JSä»£ç  end -->

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="http://github.com/brucezz" target="_blank">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                            <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://weibo.com/u/1947300213" target="_blank">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                            <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.zhihu.com/people/zeroZh" target="_blank">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                            <i class="fa fa-stack-1x fa-inverse">çŸ¥</i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://brucezz.github.io/feeds/rss.xml" target="_blank">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                            <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>.
</p><div align="center"><script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1256702937'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1256702937%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</div>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="http://brucezz.github.io/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="http://brucezz.github.io/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="http://brucezz.github.io/theme/js/clean-blog.min.js"></script>


</body>

</html>